<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OBEY ‚Äì Music Challenge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Inter:wght@400;500;600&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg: #05040a;
      --bg-panel: #0b0814;
      --bg-card: radial-gradient(circle at 0 0, #231334, #05040a 55%);
      --accent-pink: #ff4c9a;
      --accent-violet: #7e4bff;
      --accent-gold: #f6c76b;
      --accent-red: #ff3c5f;
      --accent-blue: #45b4ff;
      --ink-main: #f8f4ff;
      --ink-muted: #a598c8;
      --radius-card: 26px;
      --radius-pill: 999px;
      --shadow-hard: 0 22px 55px rgba(0,0,0,0.9);
      --shadow-soft: 0 16px 40px rgba(0,0,0,0.75);
      --transition-fast: 150ms ease-out;
      --transition-med: 230ms ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top, #221533 0, #05040a 55%),
        radial-gradient(circle at bottom, #120a1f 0, #05040a 60%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--ink-main);
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    .app-shell {
      width: 100%;
      max-width: 960px;
      padding: 18px 10px 26px;
    }

    .frame {
      background: linear-gradient(140deg, #05040a, #120b1d 60%, #05040a);
      border-radius: 30px;
      padding: 18px 14px 18px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: var(--shadow-hard);
      position: relative;
      overflow: hidden;
    }

    .frame::before {
      content: "";
      position: absolute;
      inset: -35%;
      background:
        radial-gradient(circle at 0 0, rgba(255,76,154,0.28), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(126,75,255,0.32), transparent 50%),
        radial-gradient(circle at 50% 100%, rgba(246,199,107,0.22), transparent 60%);
      opacity: 0.85;
      pointer-events: none;
      mix-blend-mode: screen;
    }
    .frame > * {
      position: relative;
      z-index: 1;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .title-block h1 {
      font-family: "Rajdhani", system-ui;
      font-size: 1.7rem;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: var(--accent-gold);
    }

    .title-block p {
      margin-top: 3px;
      font-size: 0.8rem;
      color: var(--ink-muted);
    }

    .badge-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
    }

    .pill {
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(5,4,15,0.92);
      color: var(--ink-muted);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      display: inline-flex;
      align-items: center;
      gap: 7px;
    }

    .pill-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: var(--accent-pink);
      box-shadow: 0 0 12px rgba(255,76,154,0.9);
    }

    .config-toggle {
      padding: 4px 12px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(10,8,22,0.95);
      color: var(--accent-gold);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .config-toggle span.icon { font-size: 0.9rem; }

    .config-toggle.active {
      background: linear-gradient(135deg, rgba(255,76,154,0.25), rgba(126,75,255,0.25));
      border-color: rgba(255,255,255,0.32);
    }

    .rules {
      background: rgba(5,4,15,0.9);
      border-radius: 18px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,0.08);
      font-size: 0.8rem;
      color: var(--ink-muted);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .rules strong { color: var(--ink-main); font-weight: 600; }

    .rules-tags {
      display: flex;
      gap: 6px;
      margin-top: 3px;
      flex-wrap: wrap;
    }

    .rules-tag {
      padding: 3px 8px;
      border-radius: var(--radius-pill);
      background: rgba(22,14,40,0.95);
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 0.7rem;
      color: var(--ink-muted);
    }

    .main-layout {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.4fr);
      gap: 14px;
      margin-top: 14px;
      align-items: flex-start;
    }

    @media (max-width: 720px) {
      .main-layout {
        grid-template-columns: minmax(0,1fr);
      }
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      .badge-row { align-items: flex-start; }
    }

    .card-shell { display: flex; justify-content: center; }

    .card-wrapper {
      perspective: 1400px;
      width: min(420px, 100%);
    }

    .card {
      position: relative;
      width: 100%;
      aspect-ratio: 3 / 4.2;
      border-radius: var(--radius-card);
      background: var(--bg-card);
      border: 2px solid rgba(255,255,255,0.16);
      box-shadow: var(--shadow-soft);
      padding: 16px 14px;
      overflow: hidden;
      transform-style: preserve-3d;
      transition:
        transform var(--transition-med),
        box-shadow var(--transition-med),
        border-color var(--transition-med),
        background 260ms ease-out;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(255,76,154,0.25), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(126,75,255,0.25), transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(246,199,107,0.18), transparent 60%);
      mix-blend-mode: screen;
      pointer-events: none;
      opacity: 0.9;
    }

    .card.glow-pink { border-color: rgba(255,76,154,0.9); box-shadow: 0 0 22px rgba(255,76,154,0.7), var(--shadow-soft); }
    .card.glow-violet { border-color: rgba(126,75,255,0.9); box-shadow: 0 0 22px rgba(126,75,255,0.7), var(--shadow-soft); }
    .card.glow-gold { border-color: rgba(246,199,107,0.95); box-shadow: 0 0 22px rgba(246,199,107,0.7), var(--shadow-soft); }
    .card.glow-red { border-color: rgba(255,60,95,0.9); box-shadow: 0 0 22px rgba(255,60,95,0.7), var(--shadow-soft); }
    .card.glow-blue { border-color: rgba(69,180,255,0.9); box-shadow: 0 0 22px rgba(69,180,255,0.7), var(--shadow-soft); }

    .card-content {
      position: relative;
      z-index: 1;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .card-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.78rem;
      color: var(--ink-muted);
      text-transform: uppercase;
      letter-spacing: 0.18em;
    }

    .card-tag {
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(7,6,20,0.9);
      font-size: 0.68rem;
    }

    .card-type-label {
      font-family: "Rajdhani", system-ui;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--accent-blue);
    }

    .card-title {
      margin-top: 14px;
      font-family: "Rajdhani", system-ui;
      font-size: 1.2rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      text-align: center;
      font-weight: 700;
    }

    .card-divider {
      height: 1px;
      margin: 14px 0 10px;
      background: linear-gradient(
        90deg,
        rgba(255,76,154,0.6),
        rgba(126,75,255,0.8),
        rgba(246,199,107,0.75)
      );
      opacity: 0.9;
    }

    .card-section-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--ink-muted);
      margin-bottom: 4px;
    }

    .card-text {
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .card-obey {
      font-size: 0.9rem;
      line-height: 1.4;
      color: var(--accent-gold);
    }

    .card-bonus {
      font-size: 0.84rem;
      margin-top: 4px;
      color: var(--accent-pink);
    }

    .status-challenge {
      font-size: 0.72rem;
      color: var(--ink-muted);
      margin-top: 8px;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .mode-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .mode-pill {
      flex: 1;
      min-width: 80px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(6,5,16,0.95);
      color: var(--ink-muted);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 7px 9px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition:
        background var(--transition-fast),
        color var(--transition-fast),
        box-shadow var(--transition-fast),
        border-color var(--transition-fast);
    }

    .mode-pill span.icon { font-size: 0.86rem; }

    .mode-pill.active {
      background: linear-gradient(135deg, rgba(255,76,154,0.32), rgba(126,75,255,0.32));
      border-color: rgba(246,199,107,0.6);
      color: var(--ink-main);
      box-shadow: 0 10px 22px rgba(0,0,0,0.85);
    }

    .buttons-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .btn {
      border-radius: var(--radius-pill);
      border: none;
      padding: 11px 16px;
      font-size: 0.88rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        filter var(--transition-fast),
        opacity var(--transition-fast);
      white-space: nowrap;
      font-family: "Rajdhani", system-ui;
    }

    .btn-primary {
      flex: 1 1 140px;
      color: #05040a;
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-violet));
      box-shadow: 0 12px 28px rgba(0,0,0,0.9);
    }

    .btn-ghost {
      flex: 0 0 auto;
      color: var(--ink-main);
      background: rgba(5,4,15,0.95);
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 10px 20px rgba(0,0,0,0.75);
    }

    .btn:disabled {
      opacity: 0.45;
      cursor: default;
      transform: none;
      box-shadow: 0 8px 16px rgba(0,0,0,0.6);
    }

    .btn:active:not(:disabled) {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 8px 18px rgba(0,0,0,0.9);
      filter: brightness(0.96);
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.78rem;
      color: var(--ink-muted);
    }

    .status-row strong { color: var(--accent-gold); }

    .status-pill {
      padding: 5px 11px;
      border-radius: var(--radius-pill);
      background: rgba(5,4,15,0.95);
      border: 1px solid rgba(255,255,255,0.16);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    /* Config panel */

    .config-panel {
      margin-top: 10px;
      background: rgba(5,4,15,0.95);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.16);
      padding: 10px 12px 12px;
      display: none;
      flex-direction: column;
      gap: 8px;
    }

    .config-panel.active { display: flex; }

    .config-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.78rem;
      color: var(--ink-muted);
    }

    .config-header strong { color: var(--accent-gold); }

    .config-deck-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .config-deck-row select,
    .config-deck-row input {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(8,6,20,0.98);
      color: var(--ink-main);
      font-size: 0.78rem;
      padding: 5px 8px;
      min-height: 30px;
    }

    .config-nav-buttons {
      display: flex;
      gap: 6px;
    }

    .btn-mini {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(12,10,26,0.95);
      color: var(--ink-main);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 4px 8px;
      cursor: pointer;
    }

    .btn-mini.primary {
      border-color: var(--accent-violet);
      background: linear-gradient(135deg, rgba(126,75,255,0.4), rgba(255,76,154,0.2));
    }

    .config-grid {
      display: grid;
      grid-template-columns: minmax(0,1fr);
      gap: 6px;
      margin-top: 6px;
    }

    .config-field {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .config-field label {
      font-size: 0.72rem;
      color: var(--ink-muted);
    }

    .config-field input,
    .config-field textarea,
    .config-field select {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(8,6,20,0.98);
      color: var(--ink-main);
      font-size: 0.8rem;
      padding: 6px 8px;
      resize: vertical;
      min-height: 30px;
    }

    .config-field textarea {
      min-height: 42px;
      max-height: 130px;
    }

    .config-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
    }

    .config-message {
      font-size: 0.72rem;
      color: var(--accent-gold);
      min-height: 14px;
    }

    @media (max-width: 600px) {
      .frame { padding: 16px 12px 18px; }
      .card { padding: 14px 12px; }
      .card-title { font-size: 1.06rem; letter-spacing: 0.14em; }
      .buttons-row { flex-direction: column; }
      .btn-ghost { width: 100%; }
    }

    /* Card animations */

    .card-draw {
      animation: cardDraw 0.6s ease-out;
    }
    @keyframes cardDraw {
      0% {
        transform: translateY(20px) scale(0.9) rotate3d(1,0,0,18deg);
        opacity: 0;
      }
      40% {
        transform: translateY(-6px) scale(1.03) rotate3d(1,0,0,-8deg);
        opacity: 1;
      }
      100% {
        transform: translateY(0) scale(1) rotate3d(0,0,0,0deg);
        opacity: 1;
      }
    }

    .card-shuffle {
      animation: cardShuffle 0.5s ease-in-out;
    }
    @keyframes cardShuffle {
      0% { transform: translateX(0) rotate(0deg); }
      25% { transform: translateX(-6px) rotate(-2deg); }
      50% { transform: translateX(6px) rotate(2deg); }
      75% { transform: translateX(-3px) rotate(-1deg); }
      100% { transform: translateX(0) rotate(0deg); }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="frame">
      <div class="header">
        <div class="title-block">
          <h1>OBEY</h1>
          <p>Dark music challenge ‚Ä¢ 2 players ‚Ä¢ drink, guess, obey the punishment.</p>
        </div>
        <div class="badge-row">
          <div class="pill">
            <span class="pill-dot"></span>
            <span>Play 15 sec ‚Ä¢ guess within 15 sec</span>
          </div>
          <button class="config-toggle" id="configToggle">
            <span class="icon">‚öôÔ∏è</span>
            <span>Config</span>
          </button>
        </div>
      </div>

      <div class="rules">
        <div>
          <strong>How to play:</strong>
          Hit <strong>Roll Challenge</strong>, both pick a song that fits the mood, and play the first
          <strong>15 seconds</strong> of each track.
        </div>
        <div>
          If your opponent recognises your song (artist or title) during those 15 seconds, <strong>you lose</strong>.
          Then hit <strong>Roll Punishment</strong> and obey whatever the card demands.
        </div>
        <div class="rules-tags">
          <div class="rules-tag">No repeats until each deck is empty</div>
          <div class="rules-tag">First Date ‚Ä¢ XXX ‚Ä¢ Mixed modes</div>
          <div class="rules-tag">Drink responsibly</div>
        </div>
      </div>

      <div class="main-layout">
        <div class="card-shell">
          <div class="card-wrapper">
            <div class="card glow-violet" id="card">
              <div class="card-content">
                <div>
                  <div class="card-top">
                    <span class="card-type-label" id="cardTypeLabel">Idle</span>
                    <span class="card-tag" id="cardMeta">0 / 0</span>
                  </div>
                  <div class="card-title" id="cardTitle">
                    Press Start Game
                  </div>
                  <div class="card-divider"></div>

                  <div>
                    <div class="card-section-label" id="cardSectionHeading">Info</div>
                    <div class="card-text" id="cardTheme">
                      Choose a mode, shuffle the decks, then roll a challenge. Once you know who lost the song battle, roll a punishment and obey.
                    </div>
                  </div>

                  <div class="card-bottom">
                    <div class="card-section-label" id="cardObeyHeading">Obey</div>
                    <div class="card-obey" id="cardObey">
                      First date mode keeps it playful. XXX mode goes darker: more contact, more teasing, more clothing at risk. Mixed does exactly what it sounds like.
                    </div>
                    <div class="card-bonus" id="cardBonus" style="display:none;"></div>
                  </div>
                </div>

                <div class="status-challenge" id="lastChallengeText"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="controls">
          <div class="mode-row">
            <button class="mode-pill active" data-mode="first" id="modeFirst">
              <span class="icon">üí´</span>
              <span>First Date</span>
            </button>
            <button class="mode-pill" data-mode="mixed" id="modeMixed">
              <span class="icon">‚ôüÔ∏è</span>
              <span>Mixed</span>
            </button>
            <button class="mode-pill" data-mode="xxx" id="modeXXX">
              <span class="icon">üî•</span>
              <span>XXX</span>
            </button>
          </div>

          <div class="buttons-row">
            <button class="btn btn-ghost" id="startBtn">Start Game</button>
            <button class="btn btn-primary" id="challengeBtn" disabled>üé¥ Roll Challenge</button>
            <button class="btn btn-primary" id="punishBtn" disabled>üí£ Roll Punishment</button>
          </div>

          <div class="status-row">
            <span id="statusText">
              Pick a mode, then press <strong>Start Game</strong> to shuffle all decks.
            </span>
            <span class="status-pill" id="remainingText">Challenges: 0 ‚Ä¢ Pun: 0</span>
          </div>

          <!-- CONFIG PANEL -->
          <div class="config-panel" id="configPanel">
            <div class="config-header">
              <span id="configCardLabel">Config: choose a deck</span>
              <span id="configCountLabel"></span>
            </div>

            <div class="config-deck-row">
              <label for="cfgDeckType" style="font-size:0.72rem;color:var(--ink-muted);">Deck</label>
              <select id="cfgDeckType">
                <option value="challenge">Challenges</option>
                <option value="first">Punishments ‚Äì First Date</option>
                <option value="xxx">Punishments ‚Äì XXX</option>
              </select>

              <div class="config-nav-buttons">
                <button class="btn-mini" id="cfgPrev">&lt;</button>
                <button class="btn-mini" id="cfgNext">&gt;</button>
              </div>

              <div style="display:flex;align-items:center;gap:4px;">
                <span style="font-size:0.72rem;color:var(--ink-muted);">Go to</span>
                <input id="cfgIndexInput" type="number" min="1" style="width:58px;" />
                <button class="btn-mini" id="cfgGo">Go</button>
              </div>
            </div>

            <div class="config-grid">
              <div class="config-field">
                <label for="cfgTitle">Title</label>
                <input id="cfgTitle" type="text" placeholder="Card title" />
              </div>
              <div class="config-field">
                <label for="cfgBody">Main text (theme or punishment)</label>
                <textarea id="cfgBody" placeholder="Describe the song theme or punishment"></textarea>
              </div>
              <div class="config-field">
                <label for="cfgBonus">Bonus (optional ‚Äì leave empty to remove)</label>
                <textarea id="cfgBonus" placeholder="Extra dare if they want to make it worse for themselves"></textarea>
              </div>
              <div class="config-field">
                <label for="cfgVibe">Vibe tag</label>
                <select id="cfgVibe">
                  <option value="fun">Fun</option>
                  <option value="dark">Dark</option>
                  <option value="flirty">Flirty</option>
                  <option value="chaos">Chaos</option>
                  <option value="chill">Chill</option>
                </select>
              </div>
            </div>

            <div class="config-buttons">
              <button class="btn-mini" id="cfgReset">Reset all decks</button>
              <button class="btn-mini primary" id="cfgSave">Save card</button>
            </div>
            <div class="config-message" id="configMessage"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /*
      OBEY ‚Äì multi-mode version
      - Modes: first, mixed, xxx
      - Shared challenge deck
      - Separate punishment decks for first + xxx, mixed = combined view
      - 2-step flow: roll challenge, then roll punishment
      - Config: edit any card in any deck, persisted to localStorage
    */

    const STORAGE_CHALLENGE = "obey_challenges_v2";
    const STORAGE_PUN_FIRST = "obey_pun_first_v2";
    const STORAGE_PUN_XXX   = "obey_pun_xxx_v2";

    // ---- Default decks ----
    // Short & tight so you can tweak; all editable in Config.

    const defaultChallenges = [
      { title: "Twerk Trigger", theme: "Play a song that makes hips move before the hook even hits.", vibe: "fun" },
      { title: "Villain Entrance", theme: "A track you‚Äôd use walking into a room you plan to ruin.", vibe: "dark" },
      { title: "Lip-Bite Energy", theme: "A song that feels flirty without being corny. Neck heat only.", vibe: "flirty" },
      { title: "Midnight Drive", theme: "Headlights, empty road, someone you‚Äôre not done with yet.", vibe: "chill" },
      { title: "Brat Anthem", theme: "A track with pure brat energy. Petty and proud.", vibe: "chaos" },
      { title: "Slow Burn Touch", theme: "Soft start, but you know it‚Äôs going somewhere dangerous.", vibe: "flirty" },
      { title: "Club Bathroom", theme: "Something you‚Äôd hear blasting from the wildest stall at 1AM.", vibe: "fun" },
      { title: "First Crush Flashback", theme: "A song that drags you back to your early crush days.", vibe: "chill" },
      { title: "Happy Drunk", theme: "The song that hits right when the buzz turns golden.", vibe: "fun" },
      { title: "Unskippable", theme: "A track you refuse to skip, no matter what.", vibe: "dark" },
      { title: "Sneaky Link", theme: "A soundtrack for sneaking out and hoping no one hears.", vibe: "flirty" },
      { title: "Soft Chaos", theme: "Pretty sound, unhinged lyrics.", vibe: "chaos" },
      { title: "Gym PR", theme: "A track that would push you through a personal record.", vibe: "dark" },
      { title: "Slow Grind Classic", theme: "A throwback slow jam that demands bodies close.", vibe: "flirty" },
      { title: "Kitchen Dance", theme: "Something you‚Äôd dance to while pretending to cook.", vibe: "fun" },
      { title: "Movie Trailer", theme: "Song that could score the trailer for your villain era.", vibe: "dark" },
      { title: "Tease Track", theme: "A song that sounds like it‚Äôs about to cross a line, but doesn‚Äôt.", vibe: "flirty" },
      { title: "Walk of Shame", theme: "The morning-after soundtrack for a chaotic night.", vibe: "chaos" },
      { title: "Rooftop Night", theme: "A track for a rooftop at 2AM when nobody wants to go home.", vibe: "chill" },
      { title: "Playlist Red Flag", theme: "A song that would worry you if it‚Äôs someone‚Äôs #1.", vibe: "chaos" },
      { title: "Bedroom DJ", theme: "A song you‚Äôd risk putting on in a private setting.", vibe: "flirty" },
      { title: "Festival Stage", theme: "A track that would send a festival crowd into orbit.", vibe: "fun" },
      { title: "Background Crush", theme: "A song that could loop quietly while flirting happens over it.", vibe: "flirty" },
      { title: "Afterparty Glow", theme: "A low, warm track once the loud people leave.", vibe: "chill" },
      { title: "Chaos Romance", theme: "A song that sounds like a messy situationship.", vibe: "dark" },
      { title: "Shower Concert", theme: "The track you‚Äôd absolutely scream in the shower.", vibe: "fun" },
      { title: "Boss Walk", theme: "The sound of walking into a room you already own.", vibe: "dark" },
      { title: "Stay Over", theme: "Something that might accidentally convince someone not to leave.", vibe: "flirty" },
      { title: "Low-Key Flex", theme: "A song that quietly shows off your taste.", vibe: "chill" },
      { title: "Dance Circle", theme: "Track that belongs at the center of a dance circle.", vibe: "fun" },
      { title: "Text at 2AM", theme: "Song playing while you type something you probably shouldn‚Äôt send.", vibe: "flirty" },
      { title: "Headphones Only", theme: "Hits way harder in headphones than speakers.", vibe: "chill" },
      { title: "Bad Decisions", theme: "The soundtrack of someone saying ‚Äúone more shot.‚Äù", vibe: "chaos" },
      { title: "Soft Threat", theme: "Calm voice, dangerous energy.", vibe: "dark" },
      { title: "Flirt Playlist", theme: "A song you‚Äôd sneak into a playlist for someone you like.", vibe: "flirty" },
      { title: "Credits Roll", theme: "Track that should play over the end credits of tonight.", vibe: "chill" }
    ];

    const defaultPunFirst = [
      {
        title: "Truth or Two Sips",
        text: "Winner asks any flirty question. Loser answers honestly or takes two big sips.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Lap Magnet",
        text: "Loser has to sit touching hips or knees with the winner for the next round.",
        bonus: "",
        vibe: "flirty"
      },
      {
        title: "Phone Peek",
        text: "Winner gets 10 seconds to scroll a random photo album.",
        bonus: "Loser can block one folder by name.",
        vibe: "chaos"
      },
      {
        title: "Shot Caller",
        text: "Winner chooses how loser has to sit or stand for the next song.",
        bonus: "If loser exaggerates the pose, winner drinks instead.",
        vibe: "fun"
      },
      {
        title: "Compliment Storm",
        text: "Loser must give the winner three specific compliments in a row.",
        bonus: "",
        vibe: "flirty"
      },
      {
        title: "Stare Down",
        text: "Loser maintains eye contact with winner for a full 15-count.",
        bonus: "If someone laughs or looks away, they drink.",
        vibe: "flirty"
      },
      {
        title: "Story Time",
        text: "Loser tells a short story about one of their wildest nights out.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Pet Name Test",
        text: "Winner invents a pet name. Loser has to use it once next round.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Social Dice",
        text: "Loser has to like the last photo the winner shows them.",
        bonus: "",
        vibe: "chaos"
      },
      {
        title: "Whisper Check",
        text: "Loser leans in and whispers something they like about the winner.",
        bonus: "",
        vibe: "flirty"
      },
      {
        title: "Song Dedication",
        text: "Loser must dedicate the next song they pick to the winner and say why.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Temperature Check",
        text: "Winner lightly touches loser‚Äôs wrist or neck and rates how warm they feel.",
        bonus: "",
        vibe: "flirty"
      },
      {
        title: "Truth or Dare Lite",
        text: "Winner gives loser a mild dare. If they refuse, they finish their drink.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Chair Swap",
        text: "Loser has to swap seats to wherever winner wants them for one round.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Close the Gap",
        text: "If you‚Äôre more than an arm‚Äôs length apart, loser must move closer.",
        bonus: "If you‚Äôre already close, loser has to keep one point of contact with winner.",
        vibe: "flirty"
      },
      {
        title: "Expose the Lie",
        text: "Loser shares two truths and one lie. Winner tries to spot the lie.",
        bonus: "If the winner is wrong, they drink.",
        vibe: "fun"
      },
      {
        title: "Secret Playlist",
        text: "Loser shows the winner any one playlist name from their phone.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Emoji Only",
        text: "Loser has to describe their last situationship using only three emojis.",
        bonus: "",
        vibe: "chaos"
      },
      {
        title: "Hand Test",
        text: "Loser has to place their hand on top of the winner‚Äôs for 10 seconds.",
        bonus: "",
        vibe: "flirty"
      },
      {
        title: "Voice Note",
        text: "Loser records a 5-second voice note saying something nice to the winner.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Blush Callout",
        text: "Winner names one thing that would definitely make the loser blush.",
        bonus: "Loser confirms true/false. If they lie badly, they drink.",
        vibe: "flirty"
      },
      {
        title: "Almost a Dare",
        text: "Winner describes a dare that would be ‚Äútoo much‚Äù for First Date mode.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Warm-Up Lap",
        text: "Loser has to walk across the room and back while winner rates their walk.",
        bonus: "",
        vibe: "fun"
      },
      {
        title: "Hint of Jealousy",
        text: "Loser shares something harmless that would instantly make them jealous.",
        bonus: "",
        vibe: "chill"
      }
    ];

    const defaultPunXXX = [
      {
        title: "Obedience Training",
        text: "Winner chooses one simple command for the next round (how to sit, what to call them, where to place your hands). Loser obeys.",
        bonus: "If loser asks for one extra command, winner drinks.",
        vibe: "dark"
      },
      {
        title: "Over the Knee",
        text: "Loser lies across the winner‚Äôs lap and gets a playful spanking count of five.",
        bonus: "If loser asks for more than five, winner has to take a drink.",
        vibe: "flirty"
      },
      {
        title: "Strip the Ego",
        text: "Loser removes one visible item of clothing (not underwear) or takes two drinks.",
        bonus: "If they remove a second item, winner drinks instead.",
        vibe: "dark"
      },
      {
        title: "Lap Claim",
        text: "Loser has to sit on the winner‚Äôs lap for the next full round.",
        bonus: "If loser chooses to straddle facing them, winner drinks.",
        vibe: "flirty"
      },
      {
        title: "Neck Worship",
        text: "Winner gets one slow kiss or linger along the side of loser‚Äôs neck.",
        bonus: "Loser can offer the other side as a bonus; if they do, winner drinks.",
        vibe: "flirty"
      },
      {
        title: "Blindfold Tease",
        text: "Loser closes their eyes while winner lightly positions them and speaks into their ear for 10 seconds.",
        bonus: "",
        vibe: "dark"
      },
      {
        title: "Pinned Hands",
        text: "Winner gently pins loser‚Äôs wrists (to wall, couch, or bed) for a 10-count while keeping eye contact.",
        bonus: "",
        vibe: "dark"
      },
      {
        title: "Mark of the Night",
        text: "Winner leaves a mark somewhere visible later (lip gloss on neck, bite on shoulder, etc.), if loser agrees.",
        bonus: "",
        vibe: "flirty"
      },
      {
        title: "Clothing Limit",
        text: "Loser must play the next 3 rounds down to just their underwear or finish their drink now.",
        bonus: "",
        vibe: "dark"
      },
      {
        title: "Hands Only",
        text: "Winner gets 15 seconds to explore loser‚Äôs arms, back, or hips with just their hands.",
        bonus: "If loser guides their hands somewhere, winner drinks.",
        vibe: "flirty"
      },
      {
        title: "Wall Moment",
        text: "Winner gently presses loser against the nearest surface and holds them there for one slow breath.",
        bonus: "",
        vibe: "dark"
      },
      {
        title: "Kiss Roulette",
        text: "Winner gets one kiss anywhere above the collarbone of their choosing.",
        bonus: "If loser says ‚Äúsurprise me‚Äù, winner also drinks.",
        vibe: "flirty"
      },
      {
        title: "Edge of Control",
        text: "Loser has to sit perfectly still while winner touches their neck, jawline, or lower back for 10 seconds.",
        bonus: "",
        vibe: "dark"
      },
      {
        title: "Clothes on Trial",
        text: "Winner picks one item of loser‚Äôs clothing and decides if it stays or goes.",
        bonus: "If loser refuses, they finish their drink and pay one extra dare later.",
        vibe: "chaos"
      },
      {
        title: "Breath on Skin",
        text: "Winner leans in close and lets their breath hit loser‚Äôs ear or neck for 10 seconds before saying one line.",
        bonus: "",
        vibe: "flirty"
      },
      {
        title: "On Display",
        text: "Loser must stand in front of the winner and spin slowly once while they ‚Äúinspect‚Äù the outfit.",
        bonus: "If winner asks for a slower spin and loser agrees, winner drinks.",
        vibe: "fun"
      },
      {
        title: "Pinned to the Seat",
        text: "Winner holds loser‚Äôs thighs or hips in place for the entire next song.",
        bonus: "",
        vibe: "dark"
      },
      {
        title: "Almost Too Close",
        text: "Loser moves close enough that they can feel winner‚Äôs breath but can‚Äôt actually kiss unless told to.",
        bonus: "If loser breaks first and kisses anyway, winner drinks.",
        vibe: "flirty"
      },
      {
        title: "Clothing Auction",
        text: "Winner points to an item and offers a trade: remove it or take three drinks. Loser decides.",
        bonus: "",
        vibe: "chaos"
      },
      {
        title: "Make Me Jealous",
        text: "Loser has to describe, in detail, how someone else would flirt with them successfully.",
        bonus: "If loser uses an example from real life, winner drinks.",
        vibe: "dark"
      },
      {
        title: "Body Trace",
        text: "Winner traces a slow line with a finger from loser‚Äôs wrist up their arm and to a place of their choosing above the waist.",
        bonus: "",
        vibe: "flirty"
      },
      {
        title: "Seat Change",
        text: "Loser has to sit between winner‚Äôs legs for the next round, back against their chest or facing them.",
        bonus: "",
        vibe: "flirty"
      },
      {
        title: "Heat Check",
        text: "Winner presses their palm flat on loser‚Äôs lower back or hip and rates the ‚Äútemperature.‚Äù",
        bonus: "If they call it ‚Äútoo hot‚Äù, they both drink.",
        vibe: "dark"
      },
      {
        title: "Almost Undressed",
        text: "Loser has to remove or open one layer (unzipping, unbuttoning, sliding strap) and leave it that way for one round.",
        bonus: "If they go further by choice, winner drinks.",
        vibe: "dark"
      }
    ];

    // ---- State ----
    let challenges = [];
    let punFirst = [];
    let punXXX = [];

    let mode = "first"; // "first" | "mixed" | "xxx"

    let challengeDeck = [];
    let challengeIndex = -1;

    let punDeckCurrent = [];
    let punIndex = -1;

    let lastChallengeTitle = "";

    let gameStarted = false;
    let awaitingPunishment = false;

    // Audio
    let audioCtx = null;
    function initAudio() {
      if (!audioCtx) {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (AC) audioCtx = new AC();
      }
    }
    function playTone(freq = 520, duration = 0.09, type = "triangle", volume = 0.23) {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = type;
      osc.frequency.value = freq;
      gain.gain.value = volume;
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      const now = audioCtx.currentTime;
      osc.start(now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
      osc.stop(now + duration + 0.02);
    }
    function playClickSound() { playTone(540, 0.08, "triangle", 0.25); }
    function playShuffleSound() {
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const freqs = [260, 320, 380, 440];
      freqs.forEach((f, i) => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = "square";
        osc.frequency.value = f;
        gain.gain.value = 0.13;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        const t = now + i * 0.05;
        osc.start(t);
        gain.gain.exponentialRampToValueAtTime(0.001, t + 0.08);
        osc.stop(t + 0.1);
      });
    }

    // Storage
    function loadDeck(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback.map(c => ({ ...c }));
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed) || !parsed.length) return fallback.map(c => ({ ...c }));
        return parsed;
      } catch {
        return fallback.map(c => ({ ...c }));
      }
    }
    function saveDeck(key, deck) {
      try { localStorage.setItem(key, JSON.stringify(deck)); } catch {}
    }
    function resetAllDecksToDefault() {
      challenges = defaultChallenges.map(c => ({ ...c }));
      punFirst = defaultPunFirst.map(c => ({ ...c }));
      punXXX = defaultPunXXX.map(c => ({ ...c }));
      saveDeck(STORAGE_CHALLENGE, challenges);
      saveDeck(STORAGE_PUN_FIRST, punFirst);
      saveDeck(STORAGE_PUN_XXX, punXXX);
      buildDecks();
    }

    // Initial load
    challenges = loadDeck(STORAGE_CHALLENGE, defaultChallenges);
    punFirst = loadDeck(STORAGE_PUN_FIRST, defaultPunFirst);
    punXXX = loadDeck(STORAGE_PUN_XXX, defaultPunXXX);

    // Helpers
    function shuffle(arr) {
      const copy = arr.slice();
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function buildDecks() {
      challengeDeck = shuffle(challenges.map((c, idx) => ({ ...c, id: idx + 1 })));
      challengeIndex = -1;
      buildPunDeckForMode();
      punIndex = -1;
      updateRemaining();
    }

    function buildPunDeckForMode() {
      if (mode === "first") {
        punDeckCurrent = shuffle(punFirst.map((c, idx) => ({ ...c, id: idx + 1, source: "first" })));
      } else if (mode === "xxx") {
        punDeckCurrent = shuffle(punXXX.map((c, idx) => ({ ...c, id: idx + 1, source: "xxx" })));
      } else { // mixed
        const deckA = punFirst.map((c, idx) => ({ ...c, id: idx + 1, source: "first" }));
        const deckB = punXXX.map((c, idx) => ({ ...c, id: idx + 1, source: "xxx" }));
        punDeckCurrent = shuffle(deckA.concat(deckB));
      }
    }

    function glowClassForVibe(vibe) {
      switch (vibe) {
        case "fun": return "glow-gold";
        case "dark": return "glow-red";
        case "flirty": return "glow-pink";
        case "chaos": return "glow-violet";
        case "chill": return "glow-blue";
        default: return "glow-gold";
      }
    }

    // DOM refs
    const cardEl = document.getElementById("card");
    const cardTypeLabel = document.getElementById("cardTypeLabel");
    const cardMeta = document.getElementById("cardMeta");
    const cardTitleEl = document.getElementById("cardTitle");
    const cardSectionHeading = document.getElementById("cardSectionHeading");
    const cardThemeEl = document.getElementById("cardTheme");
    const cardObeyHeading = document.getElementById("cardObeyHeading");
    const cardObeyEl = document.getElementById("cardObey");
    const cardBonusEl = document.getElementById("cardBonus");
    const lastChallengeText = document.getElementById("lastChallengeText");

    const startBtn = document.getElementById("startBtn");
    const challengeBtn = document.getElementById("challengeBtn");
    const punishBtn = document.getElementById("punishBtn");
    const statusTextEl = document.getElementById("statusText");
    const remainingTextEl = document.getElementById("remainingText");

    const modeFirstBtn = document.getElementById("modeFirst");
    const modeMixedBtn = document.getElementById("modeMixed");
    const modeXXXBtn = document.getElementById("modeXXX");

    const configToggle = document.getElementById("configToggle");
    const configPanel = document.getElementById("configPanel");
    const configCardLabel = document.getElementById("configCardLabel");
    const configCountLabel = document.getElementById("configCountLabel");
    const configMessage = document.getElementById("configMessage");
    const cfgDeckType = document.getElementById("cfgDeckType");
    const cfgPrev = document.getElementById("cfgPrev");
    const cfgNext = document.getElementById("cfgNext");
    const cfgGo = document.getElementById("cfgGo");
    const cfgIndexInput = document.getElementById("cfgIndexInput");
    const cfgTitle = document.getElementById("cfgTitle");
    const cfgBody = document.getElementById("cfgBody");
    const cfgBonus = document.getElementById("cfgBonus");
    const cfgVibe = document.getElementById("cfgVibe");
    const cfgSave = document.getElementById("cfgSave");
    const cfgReset = document.getElementById("cfgReset");

    // Config state
    let cfgIndex = 0;

    function updateRemaining() {
      const remainingChallenges = challengeDeck.length - (challengeIndex + 1);
      const remainingPun = punDeckCurrent.length - (punIndex + 1);
      remainingTextEl.textContent = `Challenges: ${Math.max(remainingChallenges,0)} ‚Ä¢ Pun: ${Math.max(remainingPun,0)}`;
    }

    function setMode(newMode) {
      mode = newMode;
      modeFirstBtn.classList.toggle("active", mode === "first");
      modeMixedBtn.classList.toggle("active", mode === "mixed");
      modeXXXBtn.classList.toggle("active", mode === "xxx");

      buildPunDeckForMode();
      punIndex = -1;
      updateRemaining();
      if (!gameStarted) {
        statusTextEl.innerHTML = `Mode set to <strong>${mode === "first" ? "First Date" : mode === "xxx" ? "XXX" : "Mixed"}</strong>. Press <strong>Start Game</strong> to shuffle decks.`;
      }
    }

    function displayChallenge(card) {
      cardEl.classList.remove("glow-pink","glow-violet","glow-gold","glow-red","glow-blue");
      cardEl.classList.add(glowClassForVibe(card.vibe || "fun"));

      cardTypeLabel.textContent = "Challenge";
      cardMeta.textContent = `Card ${challengeIndex + 1} / ${challengeDeck.length}`;
      cardTitleEl.textContent = card.title || "Challenge";
      cardSectionHeading.textContent = "Theme";
      cardThemeEl.textContent = card.theme || "";
      cardObeyHeading.textContent = "How to win";
      cardObeyEl.textContent = "Pick your song carefully. You want something that fits this mood but they‚Äôve never heard.";
      cardBonusEl.style.display = "none";
      cardBonusEl.textContent = "";
      lastChallengeText.textContent = "";
    }

    function displayPunishment(card) {
      cardEl.classList.remove("glow-pink","glow-violet","glow-gold","glow-red","glow-blue");
      cardEl.classList.add(glowClassForVibe(card.vibe || "dark"));

      cardTypeLabel.textContent = mode === "xxx" ? "XXX Punishment" : "Punishment";
      cardMeta.textContent = `Card ${punIndex + 1} / ${punDeckCurrent.length}`;
      cardTitleEl.textContent = card.title || "Punishment";
      cardSectionHeading.textContent = "Obey";
      cardThemeEl.textContent = card.text || "";
      cardObeyHeading.textContent = "Bonus (optional)";
      if (card.bonus && card.bonus.trim().length > 0) {
        cardBonusEl.style.display = "block";
        cardBonusEl.textContent = card.bonus;
      } else {
        cardBonusEl.style.display = "none";
        cardBonusEl.textContent = "";
      }
      lastChallengeText.textContent = lastChallengeTitle ? `Last challenge: ${lastChallengeTitle}` : "";
    }

    function animateCard() {
      cardEl.classList.remove("card-draw");
      void cardEl.offsetWidth;
      cardEl.classList.add("card-draw");
    }

    function startGame() {
      initAudio();
      playShuffleSound();
      buildDecks();
      gameStarted = true;
      awaitingPunishment = false;
      challengeBtn.disabled = false;
      punishBtn.disabled = true;
      cardEl.classList.add("card-shuffle");
      setTimeout(() => cardEl.classList.remove("card-shuffle"), 520);
      statusTextEl.innerHTML = "Decks shuffled. Roll a challenge, battle your songs, then roll a punishment.";
    }

    function rollChallenge() {
      if (!gameStarted) return;
      initAudio();
      playClickSound();
      if (challengeIndex + 1 >= challengeDeck.length) {
        statusTextEl.innerHTML = "Challenge deck empty. Press <strong>Start Game</strong> to reshuffle.";
        challengeBtn.disabled = true;
        return;
      }
      challengeIndex++;
      const card = challengeDeck[challengeIndex];
      lastChallengeTitle = card.title || "";
      awaitingPunishment = true;
      punishBtn.disabled = false;

      animateCard();
      setTimeout(() => displayChallenge(card), 90);
      statusTextEl.innerHTML = "Play 15 seconds each. If they guess your song in time, you lose and must roll a punishment.";
      updateRemaining();
    }

    function rollPunishment() {
      if (!gameStarted || !awaitingPunishment) return;
      initAudio();
      playClickSound();
      if (punIndex + 1 >= punDeckCurrent.length) {
        statusTextEl.innerHTML = "Punishment deck empty in this mode. Press <strong>Start Game</strong> to reshuffle.";
        punishBtn.disabled = true;
        return;
      }
      punIndex++;
      const card = punDeckCurrent[punIndex];
      awaitingPunishment = false;
      // After punishment, you need to roll a new challenge before more punishment
      punishBtn.disabled = true;

      animateCard();
      setTimeout(() => displayPunishment(card), 90);
      statusTextEl.innerHTML = "Loser obeys the punishment. Bonus is optional: if they choose the bonus, the winner drinks.";
      updateRemaining();
    }

    // Config helpers
    function getCfgDeck() {
      const type = cfgDeckType.value;
      if (type === "challenge") return { arr: challenges, label: "Challenges" };
      if (type === "first") return { arr: punFirst, label: "Punishments ‚Äì First Date" };
      return { arr: punXXX, label: "Punishments ‚Äì XXX" };
    }

    function loadConfigCard() {
      const { arr, label } = getCfgDeck();
      if (!arr.length) return;
      if (cfgIndex < 0) cfgIndex = 0;
      if (cfgIndex >= arr.length) cfgIndex = arr.length - 1;
      const card = arr[cfgIndex];

      configCardLabel.textContent = `${label}: card ${cfgIndex + 1}`;
      configCountLabel.textContent = `${arr.length} cards total`;
      cfgIndexInput.value = cfgIndex + 1;

      cfgTitle.value = card.title || "";
      if (cfgDeckType.value === "challenge") {
        cfgBody.value = card.theme || "";
        cfgBonus.value = "";
      } else {
        cfgBody.value = card.text || "";
        cfgBonus.value = card.bonus || "";
      }
      cfgVibe.value = card.vibe || "fun";
      configMessage.textContent = "";
    }

    function saveConfigCard() {
      const { arr, label } = getCfgDeck();
      if (!arr.length) return;
      const card = arr[cfgIndex];
      card.title = (cfgTitle.value || "").trim();
      if (cfgDeckType.value === "challenge") {
        card.theme = (cfgBody.value || "").trim();
        card.bonus = "";
      } else {
        card.text = (cfgBody.value || "").trim();
        card.bonus = (cfgBonus.value || "").trim();
      }
      card.vibe = cfgVibe.value || "fun";
      arr[cfgIndex] = card;

      if (cfgDeckType.value === "challenge") {
        challenges = arr;
        saveDeck(STORAGE_CHALLENGE, challenges);
      } else if (cfgDeckType.value === "first") {
        punFirst = arr;
        saveDeck(STORAGE_PUN_FIRST, punFirst);
      } else {
        punXXX = arr;
        saveDeck(STORAGE_PUN_XXX, punXXX);
      }
      configMessage.textContent = "Saved. Changes are stored on this device.";
      // Rebuild decks so new vibes/titles show up on draw
      buildDecks();
    }

    // Event wiring
    startBtn.addEventListener("click", () => {
      startGame();
    });

    challengeBtn.addEventListener("click", () => {
      rollChallenge();
    });

    punishBtn.addEventListener("click", () => {
      rollPunishment();
    });

    modeFirstBtn.addEventListener("click", () => setMode("first"));
    modeMixedBtn.addEventListener("click", () => setMode("mixed"));
    modeXXXBtn.addEventListener("click", () => setMode("xxx"));

    configToggle.addEventListener("click", () => {
      const active = configPanel.classList.toggle("active");
      configToggle.classList.toggle("active", active);
      if (active) {
        cfgDeckType.value = "challenge";
        cfgIndex = 0;
        loadConfigCard();
      }
    });

    cfgDeckType.addEventListener("change", () => {
      cfgIndex = 0;
      loadConfigCard();
    });

    cfgPrev.addEventListener("click", () => {
      const { arr } = getCfgDeck();
      if (!arr.length) return;
      cfgIndex = (cfgIndex - 1 + arr.length) % arr.length;
      loadConfigCard();
    });

    cfgNext.addEventListener("click", () => {
      const { arr } = getCfgDeck();
      if (!arr.length) return;
      cfgIndex = (cfgIndex + 1) % arr.length;
      loadConfigCard();
    });

    cfgGo.addEventListener("click", () => {
      const { arr } = getCfgDeck();
      const val = parseInt(cfgIndexInput.value, 10);
      if (!arr.length || isNaN(val)) return;
      const idx = val - 1;
      if (idx < 0 || idx >= arr.length) {
        configMessage.textContent = "That card number doesn‚Äôt exist in this deck.";
        return;
      }
      cfgIndex = idx;
      loadConfigCard();
    });

    cfgSave.addEventListener("click", () => {
      saveConfigCard();
    });

    cfgReset.addEventListener("click", () => {
      resetAllDecksToDefault();
      cfgIndex = 0;
      loadConfigCard();
      configMessage.textContent = "All decks reset to original cards.";
    });

    // Initial
    buildDecks();
    updateRemaining();
  </script>
</body>
</html>
