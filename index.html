<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OBSCURA ‚Äì Music Drinking Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <style>
    :root {
      --bg1: #0b1020;
      --bg2: #151a2e;
      --accent1: #ff5f91;
      --accent2: #5f8dff;
      --accent3: #ffd065;
      --card-bg: #1c2140;
      --text-main: #f7f7ff;
      --text-muted: #b3b6d8;
      --danger: #ff7272;
      --success: #4ade80;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.55);
      --radius-xl: 24px;
      --radius-lg: 18px;
      --radius-pill: 999px;
      --transition-fast: 150ms ease-out;
      --transition-med: 220ms ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #252b52 0, #050714 60%);
      color: var(--text-main);
    }

    .app-shell {
      width: 100%;
      max-width: 900px;
      padding: env(safe-area-inset-top, 16px) 10px env(safe-area-inset-bottom, 20px);
    }

    .app-inner {
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      border-radius: 28px;
      padding: 18px 14px 22px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255, 255, 255, 0.06);
      position: relative;
      overflow: hidden;
    }

    .app-inner::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(255, 95, 145, 0.11), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(95, 141, 255, 0.13), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .app-inner > * {
      position: relative;
      z-index: 1;
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 12px;
    }

    .title-block h1 {
      font-size: 1.5rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent3);
    }

    .title-block p {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .right-header-actions {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
    }

    .pill {
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      background: rgba(21, 26, 54, 0.9);
      color: var(--text-muted);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 10px rgba(74, 222, 128, 0.7);
    }

    .config-toggle {
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(10, 12, 28, 0.85);
      color: var(--accent2);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .config-toggle span.icon {
      font-size: 0.9rem;
    }

    .config-toggle.active {
      background: rgba(95, 141, 255, 0.18);
      color: var(--accent3);
      border-color: var(--accent2);
    }

    .rules-card {
      background: rgba(10, 12, 28, 0.9);
      border-radius: var(--radius-lg);
      padding: 10px 12px 9px;
      border: 1px solid rgba(255, 255, 255, 0.07);
      font-size: 0.78rem;
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .rules-card strong {
      color: var(--text-main);
      font-weight: 600;
    }

    .rules-badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .rules-tag {
      padding: 3px 8px;
      border-radius: var(--radius-pill);
      background: rgba(22, 26, 58, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 14px;
      margin-top: 14px;
    }

    @media (max-width: 720px) {
      .layout-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card-frame {
      background: radial-gradient(circle at top, #303566, #12152c);
      border-radius: var(--radius-xl);
      padding: 16px 14px;
      border: 1px solid rgba(255, 255, 255, 0.09);
      box-shadow: 0 18px 30px rgba(0, 0, 0, 0.55);
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .card-badge-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .card-badge-row span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .card-counter {
      padding: 4px 9px;
      border-radius: var(--radius-pill);
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .card-inner {
      background: rgba(12, 15, 37, 0.95);
      border-radius: 18px;
      padding: 13px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      min-height: 140px;
      position: relative;
      overflow: hidden;
    }

    .card-inner::before {
      content: "";
      position: absolute;
      inset: -20%;
      background:
        radial-gradient(circle at 0 100%, rgba(255, 95, 145, 0.12), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(95, 141, 255, 0.18), transparent 55%);
      opacity: 0;
      transition: opacity var(--transition-med);
      pointer-events: none;
    }

    .card-inner.active::before {
      opacity: 1;
    }

    .card-title {
      font-size: 1.05rem;
      font-weight: 650;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #ffffff;
    }

    .card-sub {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 1px;
    }

    .card-section-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(255, 255, 255, 0.55);
      margin-top: 6px;
      margin-bottom: 1px;
    }

    .card-body {
      font-size: 0.86rem;
      color: var(--text-main);
    }

    .card-punishment {
      font-size: 0.86rem;
      color: var(--accent3);
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-self: stretch;
    }

    .roll-button {
      width: 100%;
      border: none;
      border-radius: var(--radius-pill);
      padding: 13px 18px;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      color: #050612;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
        filter var(--transition-fast), opacity var(--transition-fast);
    }

    .roll-button span.icon {
      font-size: 1.1rem;
    }

    .roll-button::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.45), transparent 60%);
      opacity: 0;
      mix-blend-mode: screen;
      transition: opacity var(--transition-fast);
      pointer-events: none;
    }

    .roll-button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.75);
      filter: brightness(0.98);
    }

    .roll-button[disabled] {
      opacity: 0.7;
      cursor: default;
      transform: none;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.6);
    }

    .status-line {
      font-size: 0.78rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .status-line strong {
      color: var(--accent3);
      font-weight: 500;
    }

    .tiny {
      font-size: 0.75rem;
    }

    .rolling {
      animation: wobble 0.4s ease-in-out infinite alternate;
    }

    @keyframes wobble {
      0% { transform: translateY(0) rotate(-0.4deg); }
      100% { transform: translateY(-1px) rotate(0.4deg); }
    }

    .card-inner.reveal {
      animation: revealCard 260ms ease-out;
    }

    @keyframes revealCard {
      0% {
        transform: translateY(10px) scale(0.97);
        opacity: 0;
      }
      100% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    /* CONFIG PANEL */

    .config-panel {
      margin-top: 8px;
      background: rgba(5, 7, 20, 0.96);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      padding: 10px 12px 12px;
      display: none;
      flex-direction: column;
      gap: 8px;
    }

    .config-panel.active {
      display: flex;
    }

    .config-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .config-header span {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .config-card-label {
      font-size: 0.78rem;
      color: var(--accent3);
    }

    .config-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 6px;
      margin-top: 4px;
    }

    .config-field {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .config-field label {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .config-field input,
    .config-field textarea,
    .config-field select {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(10, 12, 30, 0.98);
      color: var(--text-main);
      font-size: 0.8rem;
      padding: 6px 8px;
      resize: vertical;
      min-height: 30px;
    }

    .config-field textarea {
      min-height: 46px;
      max-height: 120px;
    }

    .config-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
    }

    .btn-small {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 255, 255, 0.22);
      background: rgba(18, 22, 45, 0.95);
      color: var(--text-main);
      padding: 6px 10px;
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
    }

    .btn-small.save {
      border-color: var(--accent2);
      background: linear-gradient(135deg, rgba(95,141,255,0.4), rgba(95,141,255,0.1));
      color: #f9f9ff;
    }

    .config-message {
      font-size: 0.72rem;
      color: var(--success);
      min-height: 14px;
    }

    @media (max-width: 480px) {
      .title-block h1 {
        font-size: 1.35rem;
      }
      .app-inner {
        padding: 16px 12px 18px;
      }
      .card-frame {
        padding: 14px 12px;
      }
      .card-title {
        font-size: 0.98rem;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="app-inner">
      <div class="header-row">
        <div class="title-block">
          <h1>OBSCURA</h1>
          <p>Two-player music drinking game ‚Ä¢ Roll a random prompt and dare.</p>
        </div>
        <div class="right-header-actions">
          <div class="pill">
            <span class="pill-dot"></span>
            <span>Tap roll to draw a card</span>
          </div>
          <button class="config-toggle" id="configToggle">
            <span class="icon">‚öôÔ∏è</span>
            <span>Config Mode</span>
          </button>
        </div>
      </div>

      <div class="rules-card">
        <div>
          <strong>Core rule:</strong> Play the first <strong>15 seconds</strong> of your song.
          If your opponent can name the <strong>song or artist within 10 seconds</strong>, you lose the round.
        </div>
        <div><strong>Loser drinks</strong> and completes the punishment on the card.</div>
        <div class="rules-badge-row">
          <div class="rules-tag">2 players</div>
          <div class="rules-tag">Fast rounds</div>
          <div class="rules-tag">iPhone-friendly</div>
        </div>
      </div>

      <div class="layout-main">
        <div class="card-frame">
          <div class="card-badge-row">
            <span>
              <span style="width:8px;height:8px;border-radius:50%;background:var(--accent1);"></span>
              <span id="cardTypeLabel">Category</span>
            </span>
            <span class="card-counter" id="cardCounter">Card 0 / 100</span>
          </div>
          <div class="card-inner" id="cardInner">
            <div class="card-title" id="cardTitle">Tap ‚ÄúRoll a Card‚Äù to start</div>
            <div class="card-sub" id="cardTagline">
              You‚Äôll get a theme to match with music and a punishment for whoever loses the round.
            </div>

            <div class="card-section-label">Theme</div>
            <div class="card-body" id="cardThemeText">
              Roll a card, both players choose a song that fits the theme. Play 15 seconds. If your opponent recognizes your track in time, you lose.
            </div>

            <div class="card-section-label">Punishment</div>
            <div class="card-punishment" id="cardPunishmentText">
              Loser drinks once. Some cards add extra dares.
            </div>
          </div>
        </div>

        <div class="controls">
          <button class="roll-button" id="rollButton">
            <span class="icon">üé¥</span>
            <span>Roll a Card</span>
          </button>
          <div class="status-line">
            <span class="tiny">
              <strong>Round flow:</strong> Both pick a song for the theme, play 15 seconds, then see if the other can name it in 10.
            </span>
          </div>

          <div class="config-panel" id="configPanel">
            <div class="config-header">
              <span class="config-card-label" id="configCardLabel">Editing: no card selected yet</span>
              <button class="btn-small" id="resetConfig">Reset All</button>
            </div>
            <div class="config-grid">
              <div class="config-field">
                <label for="cfgTitle">Title</label>
                <input id="cfgTitle" type="text" placeholder="Card title" />
              </div>
              <div class="config-field">
                <label for="cfgTagline">Tagline</label>
                <input id="cfgTagline" type="text" placeholder="Short one-line description" />
              </div>
              <div class="config-field">
                <label for="cfgTheme">Theme (what kind of song to play)</label>
                <textarea id="cfgTheme" placeholder="Describe the theme for the music pick"></textarea>
              </div>
              <div class="config-field">
                <label for="cfgPunishment">Punishment (what the loser does)</label>
                <textarea id="cfgPunishment" placeholder="Describe what the loser has to do"></textarea>
              </div>
              <div class="config-field">
                <label for="cfgVibe">Vibe label (just for flavor)</label>
                <select id="cfgVibe">
                  <option value="fun">Party / Fun</option>
                  <option value="flirty">Flirty</option>
                  <option value="stupid">Stupid / Meme</option>
                  <option value="intense">High Stakes</option>
                  <option value="custom">Custom</option>
                </select>
              </div>
            </div>
            <div class="config-buttons">
              <button class="btn-small save" id="saveConfigBtn">Save Card</button>
            </div>
            <div class="config-message" id="configMessage"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /*
      CONFIG + STORAGE:
      - Cards live in the categories array.
      - When you edit a card in Config Mode and hit "Save Card", it's stored in localStorage ("obscuraCards").
      - To reset to default, tap "Reset All" in Config Mode.
      - iPhone Safari will keep your custom deck until you clear site data.
    */

    const baseCategories = [
      {
        id: 1,
        title: "Twerk Trigger",
        tagline: "If the beat drops, someone‚Äôs moving.",
        theme: "Pick a song that makes people want to twerk instantly.",
        punishment: "Loser has to twerk for the winner for 5 seconds.",
        vibe: "fun"
      },
      {
        id: 2,
        title: "Main Character Walk-In",
        tagline: "Entrance music only.",
        theme: "Play the song you‚Äôd want playing as you walk into a party in slow motion.",
        punishment: "Loser must do a slow-motion walk across the room while the winner hypes them.",
        vibe: "fun"
      },
      {
        id: 3,
        title: "Lip-Bite Energy",
        tagline: "Not explicit, just dangerous.",
        theme: "Choose a song with subtle sexual tension ‚Äî smooth, low-key, not corny.",
        punishment: "Loser must hold eye contact with the winner for 10 seconds.",
        vibe: "flirty"
      },
      {
        id: 4,
        title: "Menace Mode",
        tagline: "Villain music only.",
        theme: "Pick a song you‚Äôd play right before doing something petty or chaotic.",
        punishment: "Loser confesses one petty thing they‚Äôve done.",
        vibe: "fun"
      },
      {
        id: 5,
        title: "Shoulder Roll",
        tagline: "If your shoulders don't move, wrong song.",
        theme: "Choose a track that makes your shoulders move without thinking.",
        punishment: "Loser must chair-dance until the next round starts.",
        vibe: "fun"
      },
      {
        id: 6,
        title: "Chaos Button",
        tagline: "Make them say: what is this?",
        theme: "Play the most unexpected, chaotic, or cursed song you can justify.",
        punishment: "Loser takes a big drink and dramatically yells the song title.",
        vibe: "stupid"
      },
      {
        id: 7,
        title: "Underrated Gem",
        tagline: "Flex your hidden taste.",
        theme: "Pick a song you swear people sleep on or that no one plays enough.",
        punishment: "Loser has to give the winner a genuine compliment.",
        vibe: "flirty"
      },
      {
        id: 8,
        title: "Throwback Punch",
        tagline: "Nostalgia with hands.",
        theme: "Choose a throwback banger that would make 2010-era you lose it.",
        punishment: "Loser sings one line from the chorus, no backing down.",
        vibe: "fun"
      },
      {
        id: 9,
        title: "Dirty Bassline",
        tagline: "Bass that feels illegal inside.",
        theme: "Pick a track with heavy bass that hits immediately.",
        punishment: "Loser drops to one knee in front of the winner for 3 seconds (then stand back up and drink).",
        vibe: "playful"
      },
      {
        id: 10,
        title: "Happy Drunk",
        tagline: "Feels like your favorite shot.",
        theme: "Choose a song that feels like being tipsy in a good way.",
        punishment: "Loser must do a dumb happy dance for 5 seconds.",
        vibe: "fun"
      },
      {
        id: 11,
        title: "Almost Making Out",
        tagline: "Right before it actually happens.",
        theme: "Pick a smooth, cozy track that would play right before a makeout, not during.",
        punishment: "Winner chooses where the loser sits next round (closer, across, side-by-side).",
        vibe: "flirty"
      },
      {
        id: 12,
        title: "Pull-In Track",
        tagline: "The space between gets smaller.",
        theme: "Choose a song that naturally makes people sit a little closer.",
        punishment: "Loser must sit wherever the winner tells them for the next round.",
        vibe: "flirty"
      },
      {
        id: 13,
        title: "Heat Check",
        tagline: "Hype or sexy, just raise the temp.",
        theme: "Pick a song that raises the energy or tension in the room.",
        punishment: "Loser has to answer one bold question from the winner.",
        vibe: "flirty"
      },
      {
        id: 14,
        title: "Meme War",
        tagline: "We‚Äôre not being serious anymore.",
        theme: "Play the funniest, dumbest, or most meme-heavy song you can.",
        punishment: "Loser must reenact 5 seconds of the music video or vibe.",
        vibe: "stupid"
      },
      {
        id: 15,
        title: "Midnight Drive",
        tagline: "Windows cracked, city passing by.",
        theme: "Choose a song you‚Äôd play driving after midnight with someone in the passenger seat.",
        punishment: "Loser has to tell one honest late-night thought.",
        vibe: "chill"
      },
      {
        id: 16,
        title: "Tension Breaker",
        tagline: "When it gets too serious, you play this.",
        theme: "Pick a song that would instantly turn tension into laughter.",
        punishment: "Loser must say one thing they find attractive about the winner.",
        vibe: "flirty"
      },
      {
        id: 17,
        title: "Entrance of Chaos",
        tagline: "You walk in, it gets loud.",
        theme: "Choose a song that would play when the wildest person shows up.",
        punishment: "Loser drinks and has to introduce themself like they‚Äôre that person.",
        vibe: "fun"
      },
      {
        id: 18,
        title: "Slow Trouble",
        tagline: "Soft, but you know it‚Äôs trouble.",
        theme: "Pick a slow song that feels like you‚Äôre about to do something you probably shouldn‚Äôt.",
        punishment: "Loser has to sit a little closer for the next 2 rounds.",
        vibe: "flirty"
      },
      {
        id: 19,
        title: "Group Chat Mention",
        tagline: "The one you‚Äôd send to the chat.",
        theme: "Choose a song you‚Äôd drop in a group chat like: ‚ÄúThis is a hit, don‚Äôt argue.‚Äù",
        punishment: "Loser admits one thing they‚Äôve lied about in a group chat.",
        vibe: "fun"
      },
      {
        id: 20,
        title: "Unskippable",
        tagline: "You never hit skip on this.",
        theme: "Play a song that you literally never skip when it comes on.",
        punishment: "Loser has to finish whatever‚Äôs in their hand or take a long sip.",
        vibe: "intense"
      }
    ];

    const TOTAL_SLOTS = 100;
    let categories = [];

    // Fill remaining slots as editable custom slots
    function buildDefaultCategories() {
      const arr = [];
      for (let i = 0; i < TOTAL_SLOTS; i++) {
        if (i < baseCategories.length) {
          arr.push({ ...baseCategories[i] });
        } else {
          const id = i + 1;
          arr.push({
            id,
            title: `Custom Slot ${id}`,
            tagline: "Edit this slot in Config Mode to add your own idea.",
            theme: "Set your own music theme in Config Mode.",
            punishment: "Set your own punishment in Config Mode.",
            vibe: "custom"
          });
        }
      }
      return arr;
    }

    // STORAGE
    const STORAGE_KEY = "obscuraCards_v1";

    function loadFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return null;
        return parsed;
      } catch (e) {
        return null;
      }
    }

    function saveToStorage() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(categories));
      } catch (e) {
        // ignore
      }
    }

    function resetStorage() {
      try {
        localStorage.removeItem(STORAGE_KEY);
      } catch (e) {
        // ignore
      }
    }

    // INIT
    const stored = loadFromStorage();
    categories = stored && stored.length === TOTAL_SLOTS
      ? stored
      : buildDefaultCategories();

    const rollButton = document.getElementById("rollButton");
    const cardInner = document.getElementById("cardInner");
    const cardTitle = document.getElementById("cardTitle");
    const cardTagline = document.getElementById("cardTagline");
    const cardThemeText = document.getElementById("cardThemeText");
    const cardPunishmentText = document.getElementById("cardPunishmentText");
    const cardCounter = document.getElementById("cardCounter");
    const cardTypeLabel = document.getElementById("cardTypeLabel");

    const configToggle = document.getElementById("configToggle");
    const configPanel = document.getElementById("configPanel");
    const cfgTitle = document.getElementById("cfgTitle");
    const cfgTagline = document.getElementById("cfgTagline");
    const cfgTheme = document.getElementById("cfgTheme");
    const cfgPunishment = document.getElementById("cfgPunishment");
    const cfgVibe = document.getElementById("cfgVibe");
    const saveConfigBtn = document.getElementById("saveConfigBtn");
    const configMessage = document.getElementById("configMessage");
    const configCardLabel = document.getElementById("configCardLabel");
    const resetConfig = document.getElementById("resetConfig");

    let isRolling = false;
    let lastIndex = -1;

    function pickRandomIndex() {
      if (categories.length <= 1) return 0;
      let idx;
      do {
        idx = Math.floor(Math.random() * categories.length);
      } while (idx === lastIndex);
      return idx;
    }

    function setCardTypeLabel(card) {
      if (card.vibe === "flirty") {
        cardTypeLabel.textContent = "Flirty Card";
      } else if (card.vibe === "fun") {
        cardTypeLabel.textContent = "Party Card";
      } else if (card.vibe === "stupid") {
        cardTypeLabel.textContent = "Chaos Card";
      } else if (card.vibe === "intense") {
        cardTypeLabel.textContent = "High Stakes Card";
      } else if (card.vibe === "chill") {
        cardTypeLabel.textContent = "Chill Card";
      } else {
        cardTypeLabel.textContent = "Custom Card";
      }
    }

    function applyCardToUI(card) {
      cardTitle.textContent = card.title;
      cardTagline.textContent = card.tagline;
      cardThemeText.textContent = card.theme;
      cardPunishmentText.textContent = card.punishment;
      cardCounter.textContent = `Card ${card.id} / ${TOTAL_SLOTS}`;
      setCardTypeLabel(card);
    }

    function rollCard() {
      if (isRolling) return;
      isRolling = true;
      rollButton.disabled = true;
      rollButton.classList.add("rolling");
      cardInner.classList.remove("reveal", "active");

      const rollDuration = 850;
      const step = 80;

      const tempInterval = setInterval(() => {
        const idx = Math.floor(Math.random() * categories.length);
        applyCardToUI(categories[idx]);
      }, step);

      setTimeout(() => {
        clearInterval(tempInterval);
        const finalIndex = pickRandomIndex();
        lastIndex = finalIndex;
        const card = categories[finalIndex];

        applyCardToUI(card);
        cardInner.classList.add("reveal", "active");

        // update config panel fields if open
        if (configPanel.classList.contains("active")) {
          loadCurrentCardIntoConfig();
        }

        setTimeout(() => {
          isRolling = false;
          rollButton.disabled = false;
          rollButton.classList.remove("rolling");
        }, 220);
      }, rollDuration);
    }

    rollButton.addEventListener("click", rollCard);

    // CONFIG MODE

    function toggleConfigPanel() {
      if (configPanel.classList.contains("active")) {
        configPanel.classList.remove("active");
        configToggle.classList.remove("active");
      } else {
        configPanel.classList.add("active");
        configToggle.classList.add("active");
        loadCurrentCardIntoConfig();
      }
    }

    function loadCurrentCardIntoConfig() {
      configMessage.textContent = "";
      if (lastIndex < 0) {
        configCardLabel.textContent = "Editing: no card selected yet (roll one first)";
        cfgTitle.value = "";
        cfgTagline.value = "";
        cfgTheme.value = "";
        cfgPunishment.value = "";
        cfgVibe.value = "custom";
        return;
      }
      const card = categories[lastIndex];
      configCardLabel.textContent = `Editing: Card ${card.id}`;
      cfgTitle.value = card.title || "";
      cfgTagline.value = card.tagline || "";
      cfgTheme.value = card.theme || "";
      cfgPunishment.value = card.punishment || "";
      cfgVibe.value = card.vibe || "custom";
    }

    function saveCurrentCardFromConfig() {
      if (lastIndex < 0) {
        configMessage.textContent = "Roll a card before editing.";
        return;
      }
      const card = categories[lastIndex];
      card.title = cfgTitle.value.trim() || card.title;
      card.tagline = cfgTagline.value.trim() || card.tagline;
      card.theme = cfgTheme.value.trim() || card.theme;
      card.punishment = cfgPunishment.value.trim() || card.punishment;
      card.vibe = cfgVibe.value || "custom";

      categories[lastIndex] = card;
      saveToStorage();
      applyCardToUI(card);

      configMessage.textContent = "Saved. This card is now updated.";
      setCardTypeLabel(card);
      cardInner.classList.add("active");
    }

    function handleResetConfig() {
      categories = buildDefaultCategories();
      resetStorage();
      configMessage.textContent = "All cards reset to default.";
      if (lastIndex >= 0) {
        applyCardToUI(categories[lastIndex]);
        loadCurrentCardIntoConfig();
      }
    }

    configToggle.addEventListener("click", toggleConfigPanel);
    saveConfigBtn.addEventListener("click", saveCurrentCardFromConfig);
    resetConfig.addEventListener("click", handleResetConfig);

    // initial counter text
    cardCounter.textContent = `Card 0 / ${TOTAL_SLOTS}`;
  </script>
</body>
</html>
